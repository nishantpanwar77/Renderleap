<div class="ide-container" [class]="this.data().bgClass">
  <div class="ide-header">
    <div class="logo">
      <img src="rlogo.png" alt="" />
    </div>
    <div class="header-actions">
      @if (!isServerRunning) {
      <button
        (click)="runProject()"
        [disabled]="projectRunning"
        class="btns d-flex justify-content-center align-items-center btns-primary"
      >
        @if (projectRunning) {
        <span
          class="spinner-border spinner-border-sm me-2"
          role="status"
          aria-hidden="true"
        ></span>
        <small>Initializing...</small>
        }@else {
        <small>Run Project</small>
        }
      </button>
      }@else if (isServerRunning) {
      <button
        (click)="stopProject()"
        [disabled]="projectStopped"
        class="btns d-flex justify-content-center align-items-center btns-danger"
      >
        @if (projectStopped) {
        <span
          class="spinner-border spinner-border-sm me-2"
          role="status"
          aria-hidden="true"
        ></span>
        <small>Stopping...</small>
        } @else {
        <small>Stop Project</small>
        }
      </button>
      }
      <button
        class="btns-transparent-icon"
        (click)="toggleSidemenu()"
        [class.active]="isMenuOpen()"
        [attr.aria-label]="
          isMenuOpen() ? 'Close settings menu' : 'Open settings menu'
        "
        [attr.aria-expanded]="isMenuOpen()"
        type="button"
      >
        <svg height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF">
          <path
            d="m410.72-120-15.59-114.87q-21.1-6.59-46.12-20.51-25.01-13.93-42.42-29.88l-106.03 47.03-69.43-122.41 93.51-69.69q-1.92-11.67-3.15-24.45t-1.23-24.45q0-10.9 1.23-23.55 1.23-12.66 3.15-26.89l-93.51-70.2 69.43-120.36 105.26 45.74q19.72-16.2 43.23-29.74 23.51-13.54 45.31-20.23L410.72-840h138.56l15.59 115.64q24.44 8.9 45.43 20.82 20.98 11.92 40.8 29.05l108.85-45.74 68.92 120.36-96.59 71.69q3.46 13.36 4.18 25.24.72 11.89.72 22.94 0 10.28-1.1 22.09-1.11 11.81-3.87 26.96l95.56 70.31-69.44 122.41-107.23-47.8q-20.48 17.49-42 30.59-21.51 13.11-44.23 19.8L549.28-120H410.72Zm28.15-33.85h81.16l14.76-110.25q30.54-8 55.71-22.45t51.06-39.07l101.88 43.83 39.92-69.13-89.8-66.9q4.34-18.05 6.29-32.81 1.95-14.75 1.95-29.37 0-15.9-1.88-29.88-1.87-13.99-6.36-30.76l91.34-68.44-39.93-69.13-104.17 43.9q-18.83-20.9-49.04-39.14-30.22-18.24-57.73-22.45l-12.9-110.25h-82.18l-12.46 109.48q-31.72 6.31-57.79 21.14-26.06 14.84-51.29 40.38l-102.38-43.06-39.93 69.13 89.54 66.05q-4.85 14.29-6.92 30.29-2.08 16-2.08 33.51 0 15.9 2.08 31.13 2.07 15.23 6.15 30.28l-88.77 66.9 39.93 69.13 101.61-43.13q23.85 24.43 50.17 39.01 26.32 14.58 58.91 22.58l13.15 109.48Zm39.23-229.23q40.72 0 68.82-28.1 28.11-28.1 28.11-68.82 0-40.72-28.11-68.82-28.1-28.1-68.82-28.1-40.28 0-68.6 28.1-28.32 28.1-28.32 68.82 0 40.72 28.32 68.82 28.32 28.1 68.6 28.1ZM480-480Z"
          />
        </svg>
      </button>
    </div>
  </div>

  <div class="ide-body">
    <div class="panel panel-left" [style.width.px]="leftPanelWidth">
      <div class="panel-header">
        <span class="panel-title">EXPLORER</span>
      </div>
      <div class="panel-content">
        <app-file-explorer
          [files]="files"
          (fileSelected)="onFileSelected($event)"
        >
        </app-file-explorer>
      </div>
    </div>

    <!-- Resizer -->
    <div
      class="resizer vertical"
      (mousedown)="startResize($event, 'left')"
      (touchstart)="startResize($event, 'left')"
    ></div>

    <!-- Center Panel - Editor -->
    <div class="panel panel-center" [style.flex]="1">
      @if (openTabs.length > 0) {
      <div class="tabs-container">
        <div class="tabs-wrapper">
          @for (tab of openTabs; track $index) {
          <div
            class="tab"
            [class.active]="currentFile?.path === tab.path"
            (click)="selectTab(tab)"
          >
            <span class="tab-name">{{ tab.name }}</span>
            <button class="tab-close" (click)="closeTab(tab, $event)">
              <svg width="14" height="14" viewBox="0 0 14 14">
                <path
                  fill="currentColor"
                  d="M7 5.586L3.707 2.293a1 1 0 00-1.414 1.414L5.586 7l-3.293 3.293a1 1 0 101.414 1.414L7 8.414l3.293 3.293a1 1 0 001.414-1.414L8.414 7l3.293-3.293a1 1 0 00-1.414-1.414L7 5.586z"
                />
              </svg>
            </button>
          </div>
          }
        </div>
      </div>
      }
      <div class="editor-container">
        @if (currentFile) {
        <app-editor
          [currentFile]="currentFile"
          (contentChanged)="onContentChanged($event)"
        >
        </app-editor>
        } @if (!currentFile) {
        <div class="empty-state">
          <div class="empty-icon">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g
                id="SVGRepo_tracerCarrier"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></g>
              <g id="SVGRepo_iconCarrier">
                <path
                  opacity="0.5"
                  d="M2 6.94975C2 6.06722 2 5.62595 2.06935 5.25839C2.37464 3.64031 3.64031 2.37464 5.25839 2.06935C5.62595 2 6.06722 2 6.94975 2C7.33642 2 7.52976 2 7.71557 2.01738C8.51665 2.09229 9.27652 2.40704 9.89594 2.92051C10.0396 3.03961 10.1763 3.17633 10.4497 3.44975L11 4C11.8158 4.81578 12.2237 5.22367 12.7121 5.49543C12.9804 5.64471 13.2651 5.7626 13.5604 5.84678C14.0979 6 14.6747 6 15.8284 6H16.2021C18.8345 6 20.1506 6 21.0062 6.76946C21.0849 6.84024 21.1598 6.91514 21.2305 6.99383C22 7.84935 22 9.16554 22 11.7979V14C22 17.7712 22 19.6569 20.8284 20.8284C19.6569 22 17.7712 22 14 22H10C6.22876 22 4.34315 22 3.17157 20.8284C2 19.6569 2 17.7712 2 14V6.94975Z"
                  fill="#0096F4FF"
                ></path>
                <path
                  d="M20 6.23751C19.9992 5.94016 19.9949 5.76263 19.9746 5.60842C19.7974 4.26222 18.7381 3.2029 17.3919 3.02567C17.1969 3 16.9647 3 16.5003 3H9.98828C10.1042 3.10392 10.2347 3.23445 10.45 3.44975L11.0003 4C11.8161 4.81578 12.2239 5.22367 12.7124 5.49543C12.9807 5.64471 13.2653 5.7626 13.5606 5.84678C14.0982 6 14.675 6 15.8287 6H16.2024C17.9814 6 19.1593 6 20 6.23751Z"
                  fill="#001F86FF"
                ></path>
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M12.25 10C12.25 9.58579 12.5858 9.25 13 9.25H18C18.4142 9.25 18.75 9.58579 18.75 10C18.75 10.4142 18.4142 10.75 18 10.75H13C12.5858 10.75 12.25 10.4142 12.25 10Z"
                  fill="#001F86FF"
                ></path>
              </g>
            </svg>
          </div>
          <h3>No file open</h3>
          <p>Select a file from the explorer to start editing</p>
        </div>
        }
      </div>
    </div>

    <!-- Resizer -->
    <div
      class="resizer vertical"
      (mousedown)="startResize($event, 'right')"
      (touchstart)="startResize($event, 'right')"
    ></div>

    <!-- Right Panel - Preview (Always Visible) -->
    <div class="panel panel-right" [style.width.px]="rightPanelWidth">
      <div class="panel-header">
        <span class="panel-title">PREVIEW</span>
      </div>
      <div class="panel-content preview-content">
        @if (safePreviewUrl && isServerRunning) {
        <iframe
          [src]="safePreviewUrl"
          class="preview-iframe"
          (load)="onPreviewLoad()"
        >
        </iframe>
        } @if (!safePreviewUrl || !isServerRunning) {
        <div class="empty-state">
          <div class="mb-3 empty-icon">
            <img src="logorenderleap.png" alt="" />
          </div>
          <small>
            {{
              isServerRunning
                ? "Loading preview..."
                : "Your preview will appear here"
            }}
          </small>
        </div>
        }
      </div>
    </div>
  </div>

  <div class="panel panel-bottom" [style.height.px]="bottomPanelHeight">
    <div
      class="resizer horizontal"
      (mousedown)="startResize($event, 'bottom')"
      (touchstart)="startResize($event, 'bottom')"
    ></div>
    <div class="terminal-wrapper">
      <app-terminal></app-terminal>
    </div>
  </div>
</div>

<app-settings [isOpen]="isMenuOpen()" (close)="closeSidemenu()"> </app-settings>
